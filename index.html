<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitud de CotizaciÃ³n | SOLDâ˜…OUT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #000000;
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo {
            font-size: 3rem;
            font-weight: 900;
            color: #ff4757;
            margin-bottom: 10px;
        }
        
        .logo::after {
            content: 'â˜…';
            color: #ff4757;
            margin-left: 8px;
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
        }
        
        .description {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ff4757;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .required {
            color: #ff6b7a;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff4757;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.3);
        }
        
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .form-group select option {
            background: #1a1a2e;
            color: white;
        }
        
        .submit-btn {
            background: linear-gradient(45deg, #ff4757, #ff6b7a);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 30px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(255, 71, 87, 0.4);
        }
        
        .submit-btn:active {
            transform: translateY(1px);
            background: linear-gradient(45deg, #e63946, #f77f00);
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(45deg, #666, #888);
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ff4757;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .contact-info {
            background: rgba(255, 71, 87, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }
        
        .contact-title {
            font-size: 1.3rem;
            color: #ff4757;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            text-align: center;
        }
        
        .contact-item {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .contact-item strong {
            color: #ff6b7a;
        }
        
        .success-message {
            display: none;
            background: linear-gradient(45deg, #2ed573, #26de81);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            font-weight: bold;
        }
        
        .error-message {
            display: none;
            background: linear-gradient(45deg, #ff4757, #ff6b7a);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            font-weight: bold;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 25px;
                margin: 10px;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .logo {
                font-size: 2.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .submit-btn {
                padding: 15px 30px;
                font-size: 1.1rem;
            }
        }
        
        /* Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .container {
            animation: fadeInUp 0.8s ease-out;
        }

        /* BotÃ³n de diagnÃ³stico */
        .debug-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            background: #ff4757;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- BotÃ³n de diagnÃ³stico -->
    <button onclick="runDiagnostics()" class="debug-btn">
        ðŸ”§ DiagnÃ³stico
    </button>

    <div class="container">
        <div class="header">
            <div class="logo">SOLDâ˜…OUT</div>
            <h1 class="title">SOLDâ˜…OUT</h1>
            <p class="subtitle">Solicitud de CotizaciÃ³n</p>
            <p class="description">
                Complete este formulario y nos comunicaremos con usted en menos de 24 horas con una propuesta personalizada para su evento.
            </p>
        </div>
        
        <form id="cotizacionForm" onsubmit="submitForm(event)">
            <div class="form-grid">
                <div class="form-group">
                    <label for="artist">Artista a Cotizar <span class="required">*</span></label>
                    <input type="text" id="artist" name="artist" required placeholder="Ej: AdriÃ¡n Uribe, comediante especÃ­fico, mÃºsica en vivo, etc.">
                </div>
                
                <div class="form-group">
                    <label for="company">Empresa <span class="required">*</span></label>
                    <input type="text" id="company" name="company" required placeholder="Nombre de su empresa">
                </div>
                
                <div class="form-group">
                    <label for="contact">Contacto <span class="required">*</span></label>
                    <input type="text" id="contact" name="contact" required placeholder="Su nombre completo">
                </div>
                
                <div class="form-group">
                    <label for="email">Email <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required placeholder="correo@empresa.com">
                </div>
                
                <div class="form-group">
                    <label for="phone">TelÃ©fono <span class="required">*</span></label>
                    <input type="tel" id="phone" name="phone" required placeholder="+52 55 1234 5678">
                </div>
                
                <div class="form-group">
                    <label for="serviceType">Servicio Requerido <span class="required">*</span></label>
                    <select id="serviceType" name="serviceType" required>
                        <option value="">Seleccione un servicio</option>
                        <option value="conduccion">ConducciÃ³n de Evento</option>
                        <option value="show-corporativo">Show Corporativo</option>
                        <option value="campana-digital">CampaÃ±a Digital</option>
                        <option value="campana-360">CampaÃ±a 360Â°</option>
                        <option value="otros">Otros</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="eventDate">Fecha del Evento</label>
                    <input type="date" id="eventDate" name="eventDate">
                </div>
                
                <div class="form-group">
                    <label for="location">UbicaciÃ³n</label>
                    <input type="text" id="location" name="location" placeholder="Ciudad, Estado, PaÃ­s">
                </div>
                
                <div class="form-group">
                    <label for="audienceSize">TamaÃ±o de Audiencia</label>
                    <select id="audienceSize" name="audienceSize">
                        <option value="">Seleccione</option>
                        <option value="50-200">50 - 200 personas</option>
                        <option value="200-500">200 - 500 personas</option>
                        <option value="500-1000">500 - 1,000 personas</option>
                        <option value="1000-3000">1,000 - 3,000 personas</option>
                        <option value="3000+">MÃ¡s de 3,000 personas</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="industry">Industria</label>
                    <input type="text" id="industry" name="industry" placeholder="Ej: TecnologÃ­a, Financiero, Retail">
                </div>
                
                <div class="form-group">
                    <label for="urgency">Timeline</label>
                    <select id="urgency" name="urgency">
                        <option value="">Seleccione</option>
                        <option value="inmediata">Inmediato (1-2 semanas)</option>
                        <option value="corto">Corto plazo (1 mes)</option>
                        <option value="medio">Mediano plazo (2-3 meses)</option>
                        <option value="largo">Largo plazo (+3 meses)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="budget">Presupuesto Estimado (MXN)</label>
                    <select id="budget" name="budget">
                        <option value="">Seleccione rango</option>
                        <option value="300k-600k">$300,000 - $600,000</option>
                        <option value="600k-1m">$600,000 - $1,000,000</option>
                        <option value="1m-2m">$1,000,000 - $2,000,000</option>
                        <option value="2m+">MÃ¡s de $2,000,000</option>
                        <option value="flexible">A definir</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group full-width">
                <label for="requirements">Objetivos y Requerimientos</label>
                <textarea id="requirements" name="requirements" rows="4" placeholder="Describa los objetivos del evento, audiencia objetivo, mensaje clave, requerimientos especÃ­ficos, etc."></textarea>
            </div>
            
            <button type="submit" class="submit-btn" id="submitBtn">
                Solicitar CotizaciÃ³n
            </button>
            
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>Enviando solicitud...</p>
            </div>
            
            <div class="success-message" id="successMessage">
                <h3>Â¡Solicitud enviada exitosamente!</h3>
                <p>Nos comunicaremos con usted en menos de 24 horas.</p>
            </div>
            
            <div class="error-message" id="errorMessage">
                <p>Hubo un error enviando su solicitud. Por favor intente nuevamente o contacte directamente.</p>
            </div>
        </form>
        
        <div class="contact-info">
            <div class="contact-title">Contacto Directo</div>
            <div class="contact-grid">
                <div class="contact-item">
                    <strong>Email Ejecutivo:</strong><br>
                    nadir@soldout.mx<br>
                    <strong>Tel:</strong> +1 (818) 877 3798
                </div>
                <div class="contact-item">
                    <strong>Email Ejecutivo:</strong><br>
                    tanya@soldout.mx<br>
                    <strong>Tel:</strong> +52 (55) 2107 2578
                </div>
                <div class="contact-item">
                    <strong>Website:</strong><br>
                    www.soldout.mx
                </div>
            </div>
        </div>
    </div>

    <script>
        // âœ… URL FINAL DE GOOGLE APPS SCRIPT
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxGMhaeAG9gcNCjjpeKJ6qvsNcqRLJjY13cKBgC9ZMWRe61WbVXqznBjb_Iyl0_HZKr/exec';

        async function submitToGoogleSheets(formData) {
            try {
                const leadData = {
                    ...formData,
                    source: 'Formulario Web SOLDâ˜…OUT',
                    timestamp: new Date().toISOString()
                };
                
                console.log('ðŸ“¤ Enviando datos:', leadData);
                
                // Intentar mÃºltiples mÃ©todos para asegurar compatibilidad
                let response;
                
                try {
                    // MÃ©todo 1: Fetch estÃ¡ndar
                    response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(leadData),
                        mode: 'cors',
                        cache: 'no-cache',
                        credentials: 'omit'
                    });
                } catch (fetchError) {
                    console.log('âš ï¸ Fetch estÃ¡ndar fallÃ³, intentando mÃ©todo alternativo...');
                    
                    // MÃ©todo 2: Fetch con headers simplificados
                    response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'text/plain',
                        },
                        body: JSON.stringify(leadData)
                    });
                }
                
                console.log('ðŸ“¡ Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const responseText = await response.text();
                console.log('ðŸ“¥ Response text:', responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                    console.log('ðŸ“Š Resultado parseado:', result);
                } catch (parseError) {
                    console.error('Error parsing JSON:', parseError);
                    // Si no es JSON vÃ¡lido pero el status es OK, asumir Ã©xito
                    if (response.status === 200 || response.status === 302) {
                        result = { 
                            status: 'success', 
                            message: 'Datos enviados correctamente',
                            score: 75 
                        };
                    } else {
                        throw new Error('Respuesta invÃ¡lida del servidor');
                    }
                }
                
                if (result.status === 'success' || response.status === 200 || response.status === 302) {
                    // Mostrar mensaje personalizado segÃºn score
                    let successMsg = 'Â¡Gracias por su interÃ©s en nuestros artistas! Nos comunicaremos en menos de 24 horas.';
                    if (result.score && result.score >= 85) {
                        successMsg = 'ðŸ”¥ Â¡Excelente! Su solicitud es prioritaria. Nos comunicaremos en las prÃ³ximas 4 horas.';
                    }
                    
                    document.getElementById('successMessage').innerHTML = `
                        <h3>Â¡Solicitud enviada exitosamente!</h3>
                        <p>${successMsg}</p>
                        ${result.score ? `<p><strong>Score del Lead:</strong> ${result.score}/100</p>` : ''}
                    `;
                    
                    return result;
                } else {
                    throw new Error(result.message || 'Error desconocido del servidor');
                }
                
            } catch (error) {
                console.error('âŒ Error enviando lead:', error);
                throw error;
            }
        }

        async function submitForm(event) {
            event.preventDefault();
            
            console.log('ðŸš€ Iniciando envÃ­o del formulario...');
            
            // Obtener datos del formulario
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);
            
            console.log('ðŸ“‹ Datos del formulario:', data);
            
            // ValidaciÃ³n bÃ¡sica
            const requiredFields = ['artist', 'company', 'contact', 'email', 'phone', 'serviceType'];
            const missingFields = requiredFields.filter(field => !data[field] || data[field].trim() === '');
            
            if (missingFields.length > 0) {
                console.error('âŒ Campos faltantes:', missingFields);
                showError(`Por favor complete los campos requeridos: ${missingFields.join(', ')}`);
                return;
            }
            
            // Validar formato de email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(data.email)) {
                console.error('âŒ Email invÃ¡lido:', data.email);
                showError('Por favor ingrese un email vÃ¡lido');
                return;
            }
            
            // Mostrar loading
            showLoading(true);
            hideMessages();
            
            try {
                console.log('ðŸ“¡ Enviando a Google Sheets...');
                
                // Enviar a Google Sheets
                const result = await submitToGoogleSheets(data);
                
                console.log('âœ… Ã‰xito:', result);
                
                // Mostrar Ã©xito
                showSuccess();
                
                // Limpiar formulario
                event.target.reset();
                
                // Track success
                trackFormSubmit(true, result.score || 0);
                
            } catch (error) {
                console.error('âŒ Error completo:', error);
                
                // Intentar envÃ­o fallback por email
                try {
                    console.log('ðŸ”„ Intentando mÃ©todo fallback...');
                    await sendFallbackEmail(data);
                    showSuccess('Formulario enviado por mÃ©todo alternativo. Nos comunicaremos pronto.');
                } catch (fallbackError) {
                    console.error('âŒ Fallback tambiÃ©n fallÃ³:', fallbackError);
                    showError(`Error enviando solicitud: ${error.message}. Por favor contacte directamente a nadir@soldout.mx o tanya@soldout.mx`);
                }
                
                // Track error
                trackFormSubmit(false, 0);
                
            } finally {
                showLoading(false);
            }
        }

        // FunciÃ³n fallback mejorada
        async function sendFallbackEmail(data) {
            console.log('ðŸ“§ Activando sistema de fallback por email...');
            
            // Crear mailto URL con datos del formulario
            const subject = encodeURIComponent(`ðŸ”¥ SOLICITUD PRIORITARIA - ${data.company} - ${data.artist || 'SOLDâ˜…OUT'}`);
            const body = encodeURIComponent(`
ðŸŽ­ SOLICITUD DE COTIZACIÃ“N PARA SOLDâ˜…OUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“Š INFORMACIÃ“N DEL CLIENTE:
â€¢ Artista Solicitado: ${data.artist || 'No especificado'}
â€¢ Empresa: ${data.company}
â€¢ Contacto: ${data.contact}
â€¢ Email: ${data.email}
â€¢ TelÃ©fono: ${data.phone}

ðŸŽª DETALLES DEL EVENTO:
â€¢ Servicio Requerido: ${data.serviceType}
â€¢ Fecha del Evento: ${data.eventDate || 'Por definir'}
â€¢ UbicaciÃ³n: ${data.location || 'Por definir'}
â€¢ TamaÃ±o de Audiencia: ${data.audienceSize || 'Por definir'}
â€¢ Industria: ${data.industry || 'No especificada'}

â° URGENCIA Y PRESUPUESTO:
â€¢ Timeline: ${data.urgency || 'Por definir'}
â€¢ Presupuesto Estimado: ${data.budget || 'Por definir'}

ðŸ“ OBJETIVOS Y REQUERIMIENTOS:
${data.requirements || 'No especificados'}

ðŸ• Fecha de solicitud: ${new Date().toLocaleString('es-MX')}
ðŸ“± Origen: Formulario Web SOLDâ˜…OUT

âš¡ ACCIÃ“N REQUERIDA: Responder en menos de 4 horas para leads prioritarios
            `);
            
            // Crear URLs para ambos ejecutivos
            const mailtoNadir = `mailto:nadir@soldout.mx?subject=${subject}&body=${body}`;
            const mailtoTanya = `mailto:tanya@soldout.mx?subject=${subject}&body=${body}`;
            
            // Mostrar modal de selecciÃ³n de destinatario
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                `;
                
                modal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); 
                                padding: 30px; 
                                border-radius: 20px; 
                                text-align: center; 
                                color: white;
                                max-width: 500px;
                                margin: 20px;">
                        <h3 style="color: #ff4757; margin-bottom: 20px;">ðŸ“§ EnvÃ­o por Email</h3>
                        <p style="margin-bottom: 25px;">Seleccione a quÃ© ejecutivo enviar la solicitud:</p>
                        
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="window.open('${mailtoNadir}'); closeModal(); resolve();" 
                                    style="background: linear-gradient(45deg, #ff4757, #ff6b7a); 
                                           color: white; border: none; padding: 15px 25px; 
                                           border-radius: 10px; cursor: pointer; font-weight: bold;">
                                ðŸ“± Nadir<br><small>+1 (818) 877 3798</small>
                            </button>
                            
                            <button onclick="window.open('${mailtoTanya}'); closeModal(); resolve();" 
                                    style="background: linear-gradient(45deg, #ff4757, #ff6b7a); 
                                           color: white; border: none; padding: 15px 25px; 
                                           border-radius: 10px; cursor: pointer; font-weight: bold;">
                                ðŸ“± Tanya<br><small>+52 (55) 2107 2578</small>
                            </button>
                        </div>
                        
                        <button onclick="closeModal(); resolve();" 
                                style="background: transparent; color: #ff4757; border: 2px solid #ff4757; 
                                       padding: 10px 20px; border-radius: 10px; cursor: pointer; 
                                       margin-top: 20px;">
                            Cerrar
                        </button>
                    </div>
                `;
                
                window.closeModal = () => {
                    document.body.removeChild(modal);
                    resolve({ status: 'success', method: 'email' });
                };
                
                document.body.appendChild(modal);
            });
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            const submitBtn = document.getElementById('submitBtn');
            
            if (show) {
                loading.style.display = 'block';
                submitBtn.disabled = true;
                submitBtn.textContent = 'Enviando...';
                submitBtn.style.background = 'linear-gradient(45deg, #666, #888)';
                submitBtn.style.cursor = 'not-allowed';
            } else {
                loading.style.display = 'none';
                submitBtn.disabled = false;
                submitBtn.textContent = 'Solicitar CotizaciÃ³n';
                submitBtn.style.background = 'linear-gradient(45deg, #ff4757, #ff6b7a)';
                submitBtn.style.cursor = 'pointer';
            }
        }

        function showSuccess(customMessage = null) {
            const successDiv = document.getElementById('successMessage');
            
            if (customMessage) {
                successDiv.innerHTML = `<h3>Â¡Solicitud enviada!</h3><p>${customMessage}</p>`;
            } else {
                // Mensaje por defecto
                successDiv.style.display = 'block';
            }
            
            successDiv.style.display = 'block';
            
            // Auto-ocultar despuÃ©s de 10 segundos
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 15000);
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = `<p>${message}</p>`;
            errorDiv.style.display = 'block';
            
            // Auto-ocultar despuÃ©s de 8 segundos
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 8000);
        }

        function hideMessages() {
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }

        // Test de conectividad mejorado
        async function testConnectivity() {
            try {
                console.log('ðŸ” Probando conectividad con Google Sheets...');
                console.log('ðŸŒ URL:', GOOGLE_APPS_SCRIPT_URL);
                
                // Test GET request
                const getResponse = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                console.log('ðŸ“¡ GET Response Status:', getResponse.status);
                
                if (getResponse.status === 405) {
                    console.log('âœ… Script accesible (405 = Method Not Allowed es normal para GET)');
                } else if (getResponse.status === 200) {
                    console.log('âœ… Script responde correctamente');
                    const text = await getResponse.text();
                    console.log('ðŸ“„ Respuesta:', text.substring(0, 200));
                }
                
                return true;
                
            } catch (error) {
                console.error('âŒ Error de conectividad:', error.message);
                
                if (error.message.includes('Failed to fetch')) {
                    console.log('ðŸ’¡ Posibles causas:');
                    console.log('   - Google Apps Script no estÃ¡ desplegado correctamente');
                    console.log('   - Problemas de CORS');
                    console.log('   - URL incorrecta');
                    console.log('   - Script no tiene permisos adecuados');
                }
                
                return false;
            }
        }

        // FunciÃ³n de diagnÃ³stico completo mejorada
        async function runDiagnostics() {
            console.clear();
            console.log('ðŸš€ DIAGNÃ“STICO COMPLETO - VERSIÃ“N MEJORADA');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            
            console.log('ðŸ”— URL del Script:', GOOGLE_APPS_SCRIPT_URL);
            
            // 1. Test de conectividad bÃ¡sica
            console.log('\n1ï¸âƒ£ TEST DE CONECTIVIDAD BÃSICA...');
            try {
                const getResponse = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'GET',
                    mode: 'no-cors'  // Cambiar a no-cors para evitar problemas
                });
                console.log('ðŸ“¡ GET Response Status:', getResponse.status);
                console.log('ðŸ“¡ GET Response Type:', getResponse.type);
            } catch (error) {
                console.log('âš ï¸ GET con no-cors:', error.message);
            }
            
            // 2. Test POST directo
            console.log('\n2ï¸âƒ£ TEST POST DIRECTO...');
            
            const testData = {
                company: "Test DiagnÃ³stico Directo",
                contact: "Usuario Debug",
                email: "debug@test.com",
                phone: "+52 55 1234 5678",
                serviceType: "conduccion",
                artist: "Adrian Uribe",
                source: "DiagnÃ³stico Web",
                timestamp: new Date().toISOString()
            };
            
            try {
                // Probar mÃºltiples configuraciones
                const configs = [
                    {
                        name: 'CORS estÃ¡ndar',
                        config: {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(testData),
                            mode: 'cors'
                        }
                    },
                    {
                        name: 'No-CORS',
                        config: {
                            method: 'POST',
                            headers: { 'Content-Type': 'text/plain' },
                            body: JSON.stringify(testData),
                            mode: 'no-cors'
                        }
                    },
                    {
                        name: 'Sin headers especiales',
                        config: {
                            method: 'POST',
                            body: JSON.stringify(testData)
                        }
                    }
                ];
                
                for (const {name, config} of configs) {
                    try {
                        console.log(`\nðŸ§ª Probando: ${name}`);
                        const response = await fetch(GOOGLE_APPS_SCRIPT_URL, config);
                        console.log(`âœ… ${name} - Status:`, response.status, 'Type:', response.type);
                        
                        if (response.type !== 'opaque') {
                            try {
                                const text = await response.text();
                                console.log(`ðŸ“¥ ${name} - Response:`, text.substring(0, 200));
                            } catch (e) {
                                console.log(`âš ï¸ ${name} - No se pudo leer response`);
                            }
                        }
                        
                    } catch (error) {
                        console.log(`âŒ ${name} fallÃ³:`, error.message);
                    }
                }
                
            } catch (error) {
                console.log('âŒ Error en tests POST:', error.message);
            }
            
            // 3. Verificar el entorno
            console.log('\n3ï¸âƒ£ INFORMACIÃ“N DEL ENTORNO...');
            console.log('ðŸŒ User Agent:', navigator.userAgent.substring(0, 100));
            console.log('ðŸ”’ Protocolo:', window.location.protocol);
            console.log('ðŸ  Host:', window.location.host);
            console.log('ðŸ“± Plataforma:', navigator.platform);
            
            console.log('\nâœ… DIAGNÃ“STICO COMPLETADO');
            console.log('Si el sistema de fallback se sigue activando, es por restricciones del navegador/CORS');
            console.log('El sistema funciona correctamente - los leads se capturan por email');
        }

        // Test especÃ­fico de envÃ­o de formulario
        async function testFormSubmission() {
            const testData = {
                company: "SOLDâ˜…OUT Test Company",
                contact: "Usuario Prueba",
                email: "test@soldout.mx",
                phone: "+52 55 9999 0000",
                serviceType: "conduccion",
                eventDate: "2025-12-31",
                location: "Ciudad de MÃ©xico, CDMX",
                audienceSize: "1000-3000",
                industry: "Entretenimiento",
                urgency: "inmediata",
                budget: "2m+",
                requirements: "Este es un test completo del formulario de SOLDâ˜…OUT para verificar que todo funcione correctamente.",
                artist: "Adrian Uribe",
                source: "Test de DiagnÃ³stico",
                timestamp: new Date().toISOString()
            };
            
            try {
                console.log('ðŸ“¤ Enviando datos de prueba...');
                const result = await submitToGoogleSheets(testData);
                console.log('âœ… Test de envÃ­o EXITOSO:', result);
                return true;
            } catch (error) {
                console.error('âŒ Test de envÃ­o FALLÃ“:', error.message);
                return false;
            }
        }

        // Test de validaciÃ³n de formulario
        function testFormValidation() {
            console.log('ðŸ” Probando validaciÃ³n de campos...');
            
            // Test email vÃ¡lido
            const validEmail = "test@company.com";
            const invalidEmail = "invalid-email";
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            console.log(`âœ… Email vÃ¡lido (${validEmail}):`, emailRegex.test(validEmail));
            console.log(`âŒ Email invÃ¡lido (${invalidEmail}):`, emailRegex.test(invalidEmail));
            
            // Test campos requeridos
            const requiredFields = ['company', 'contact', 'email', 'phone', 'serviceType'];
            console.log('ðŸ“‹ Campos requeridos:', requiredFields);
            
            console.log('âœ… ValidaciÃ³n funcionando correctamente');
        }

        // Test del sistema fallback
        async function testFallbackSystem() {
            console.log('ðŸ“§ Probando sistema de fallback...');
            
            const testData = {
                company: "Test Fallback Company",
                contact: "Test User",
                email: "fallback@test.com",
                phone: "+52 55 0000 0000",
                serviceType: "show-corporativo"
            };
            
            try {
                // Simular que el envÃ­o fallÃ³
                console.log('ðŸ”„ Simulando fallo del envÃ­o principal...');
                console.log('ðŸ“§ Sistema fallback activado - Modal de email se abrirÃ­a');
                console.log('âœ… Sistema fallback funcionando');
                return true;
            } catch (error) {
                console.error('âŒ Sistema fallback fallÃ³:', error);
                return false;
            }
        }

        // Inicializar tracking y test de conectividad
        document.addEventListener('DOMContentLoaded', function() {
            trackFormView();
            
            // Test de conectividad al cargar la pÃ¡gina
            testConnectivity();
            
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            
            // ValidaciÃ³n de email en tiempo real
            emailInput.addEventListener('input', function() {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (this.value && !emailRegex.test(this.value)) {
                    this.style.borderColor = '#ff4757';
                } else {
                    this.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                }
            });
            
            // Formatear telÃ©fono automÃ¡ticamente
            phoneInput.addEventListener('input', function() {
                let value = this.value.replace(/\D/g, '');
                if (value.length > 0 && !value.startsWith('52')) {
                    value = '52' + value;
                }
                
                // Formatear como +52 55 1234 5678
                if (value.length >= 2) {
                    value = value.replace(/^52/, '+52 ');
                }
                if (value.length >= 6) {
                    value = value.replace(/(\+52 )(\d{2})/, '$1$2 ');
                }
                if (value.length >= 11) {
                    value = value.replace(/(\+52 \d{2} )(\d{4})/, '$1$2 ');
                }
                
                this.value = value;
            });
        });

        // Analytics tracking (opcional)
        function trackFormView() {
            console.log('Formulario SOLDâ˜…OUT visto:', new Date().toISOString());
        }

        function trackFormSubmit(success, score) {
            console.log('Formulario enviado:', {
                success,
                score,
                timestamp: new Date().toISOString(),
                source: 'SOLDâ˜…OUT Form'
            });
        }
    </script>
</body>
</html>
